@page "/hypertrophy"
@using WebsiteFirstDraft.Data.Models
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject UISettingsService UIService

@* PSEUDOCODE / PLAN:
   - Ensure the numeric accumulators (sets, reps, weight, rpe, rir) never become negative.
   - Replace plain text value attributes with numeric inputs bound to the backing fields so UI reflects model.
   - For each decrement method: only decrement when current value > 0.
   - For safety, clamp values on any set operations (use Math.Max for ints; for uint ensure non-negative via checks).
   - Disable the decrement button in the UI when value is zero to give visual affordance.
   - Keep increment operations as simple increments.
   - Maintain existing UI layout and minimal changes to behavior.
*@

<h3 class=text-center>Hypertrophy</h3>
<link rel="stylesheet " href="~/customcsspages/FoodLogging.css" />


<p class="blockquote text-center">Introductory message + explanation of use</p>

<div class="container-fluid">
    <div class="row d-flex align-items-stretch">

        <!-- Textarea column -->
        <div class="col-sm-10 d-flex">
            <textarea class="form-control w-100" style="resize:none; min-height:70px;"
                      placeholder="Search for Exercise from Database"></textarea>
        </div>

        <!-- Button column -->
        <div class="col-sm-2 d-flex">
            <button type="button" class="btn btn-secondary" @onclick="NavToHypertrophy">Hypertrophy page</button>
        </div>

    </div>
</div>

<hr />
<div class="container-fluid">
    <div class="row d-flex align-items-stretch">


        <div class="col-sm-10 d-flex">
            <ul class="list-group w-100">
                <li class="list-group-item">An item</li>
                <li class="list-group-item">A second item</li>
                <li class="list-group-item">A third item</li>
                <li class="list-group-item">A fourth item</li>
                <li class="list-group-item">And a fifth one</li>
            </ul>
        </div>


        <div class="col-sm-2 d-flex flex-column">

            <div class="flex-grow-1 mb-2">
                <div class="form-control d-flex justify-content-center align-items-center h-100">
                    Exercise Grade: A
                </div>
            </div>


            <div class="flex-grow-2 d-flex">
                <button type="button" class="btn btn-primary w-100 h-100" @onclick="OpenPopup">
                    Log
                </button>
            </div>

        </div>

    </div>
</div>


<br />
<label>Manual Entry</label>
<div class="form-floating textbox">
    <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea"></textarea>
    <label for="floatingTextarea">Exercise</label>
</div>



<Popup @bind-IsVisible="showPopup" Title="Hypertrophy Logging Page">
    <p >Name of Exercise</p>
    @*Need to implement a toggle system*@



    <div class="container">

        @*Sets*@
        <div class="row align-items-center mb-3">
            <div class="col-4 text-end">
                <label class="form-label mb-0">Sets</label>
            </div>
            <div class="col-8">
                <div class="input-group" style="max-width: 160px;">
                    @*Minus button*@
                    <button class="btn btn-outline-secondary" @onclick="DecrementSet" disabled="@(setAccumulator == 0)">−</button>

                    @*Numeric bound input*@
                    <input type="number" class="form-control text-center" @bind="setAccumulator" min="0" />

                    @*Plus button*@
                    <button class="btn btn-outline-secondary" @onclick="IncrementSet">+</button>
                </div>
            </div>
        </div>

        @*Reps*@
        <div class="row align-items-center mb-3">
            <div class="col-4 text-end">
                <label class="form-label mb-0">Reps</label>
            </div>
            <div class="col-8">
                <div class="input-group" style="max-width: 160px;">
                    <button class="btn btn-outline-secondary" @onclick="DecrementRep" disabled="@(repAccumulator == 0)">−</button>
                    <input type="number" class="form-control text-center" @bind="repAccumulator" min="0" />
                    <button class="btn btn-outline-secondary" @onclick="IncrementRep">+</button>
                </div>
            </div>
        </div>

        @*Weight*@
        <div class="row align-items-center mb-3">
            <div class="col-4 text-end">
                <label class="form-label mb-0">Weight</label>
            </div>
            <div class="col-8">
                <div class="input-group" style="max-width: 160px;">
                    <button class="btn btn-outline-secondary" @onclick="DecrementWeight" disabled="@(weightAccumulator == 0)">−</button>
                    <input type="number" class="form-control text-center" @bind="weightAccumulator" min="0" />
                    <button class="btn btn-outline-secondary" @onclick="IncrementWeight">+</button>
                </div>
            </div>
        </div>
        @if (UIService.Settings.ShowAdvancedMetrics)
        {
            @*RPE*@
            <div class="row align-items-center mb-3">
                <div class="col-4 text-end">
                    <label class="form-label mb-0">RPE</label>
                </div>
                <div class="col-8">
                    <div class="input-group" style="max-width: 160px;">
                        <button class="btn btn-outline-secondary" @onclick="Decrementrpe" disabled="@(rpeAccumulator == 0)">−</button>
                        <input type="number" class="form-control text-center" @bind="rpeAccumulator" min="0" />
                        <button class="btn btn-outline-secondary" @onclick="Incrementrpe" disabled="@(rpeAccumulator == 10)">+</button>
                    </div>
                </div>
            </div>

            @*RIR*@
            <div class="row align-items-center">
                <div class="col-4 text-end">
                    <label class="form-label mb-0">RIR</label>
                </div>
                <div class="col-8">
                    <div class="input-group" style="max-width: 160px;">
                        <button class="btn btn-outline-secondary" @onclick="Decrementrir" disabled="@(rirAccumulator == 0)">−</button>
                        <input type="number" class="form-control text-center" @bind="rirAccumulator" min="0" />
                        <button class="btn btn-outline-secondary" @onclick="Incrementrir" disabled="@(rirAccumulator == 10)">+</button>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="d-sm-flex justify-content-between">
        <button type="button" class="btn btn-primary">Log</button>
        <button type="button" class="btn btn-primary">Graphs</button>
    </div>

</Popup>

<div class="d-sm-flex justify-content-between">
    <div class="dropdown-center">
        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Exercise Type
        </button>
        <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Sets and Reps</a></li>
            <li><a class="dropdown-item" href="#">Distance and Time</a></li>
            <li><a class="dropdown-item" href="#">Speed and Time</a></li>
        </ul>
    </div>
    <button type="button" class="btn btn-secondary" @onclick="OpenPopup">Log</button>
    <button type="button" class="btn btn-info">Generate a Workout Split</button>
</div>

@code {

    private void NavToHypertrophy()
        => NavigationManager.NavigateTo("hypertrophy");

    private bool showPopup;

    private void OpenPopup()
        => showPopup = true;

    // Sets: using uint (non-negative by type). Guard decrement to avoid underflow.
    private byte setAccumulator = 0;
    private void IncrementSet() => setAccumulator++;
    private void DecrementSet()
    {
        if (setAccumulator > 0)
        {
            setAccumulator--;
        }
    }

    // Reps
    private byte repAccumulator = 0;
    private void IncrementRep() => repAccumulator++;
    private void DecrementRep()
    {
        if (repAccumulator > 0)
        {
            repAccumulator--;
        }
    }

    // Weight
    private float weightAccumulator = 0f;
    private void IncrementWeight() => weightAccumulator++;
    private void DecrementWeight()
    {
        if (weightAccumulator > 0)
        {
            weightAccumulator--;
        }
    }

    // RPE
    private byte rpeAccumulator = 0;
    private void Incrementrpe()
    {
        if (rpeAccumulator < 10)
        {
            rpeAccumulator++;
        }
    }
    private void Decrementrpe()
    {
        if (rpeAccumulator > 0)
        {
            rpeAccumulator--;
        }
    }

    // RIR
    private byte rirAccumulator = 0;
    private void Incrementrir()
    {
        if (rirAccumulator < 10)
        {
            rirAccumulator++;
        }
    }
    private void Decrementrir()
    {
        if (rirAccumulator > 0)
        {
            rirAccumulator--;
        }
    }

}

